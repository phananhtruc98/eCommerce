<%@ Page Language="C#" Title="Quản lý người mua" MasterPageFile="~/Admin/Admin.Master" AutoEventWireup="true" CodeBehind="ManageAdministrator.aspx.cs" Inherits="ShoesStore.Admin.Manage_Administrator" %>

<%@ Import Namespace="ShoesStore" %>
<%@ MasterType VirtualPath="~/Admin/Admin.Master" %>
<asp:Content ID="BodyContent" ContentPlaceHolderID="MainContent" runat="server">

    <div id="TimKiem" class="container">
        <div class="btn btn-lg custom_bar col-12">Danh sách quản trị viên</div>
        <div class="row">
            <div class="col-3"></div>
            <div class="col-9">
                <asp:TextBox runat="server" placeholder="Gõ vào đây..." ID="txtTimKiem"></asp:TextBox>
                <asp:Button runat="server" ID="btnTimKiem" Text="Tìm" CssClass="btn btn-inverse-dark" OnClick="btnTimKiem_Click" />
            </div>
        </div>
        <div class="row">
            <div class="col-12 table-responsive">
                <asp:GridView ID="gvAdmin" ItemType="ShoesStore.DataAccessLogicLayer.Mstr" runat="server" AutoGeneratedColumns="true" BackColor="White" BorderColor="#CC9966" BorderWidth="1px" CellPadding="4" BorderStyle="None" AutoGenerateColumns="False" AllowPaging="True" Style="margin-top: 0" AllowSorting="True" OnSorting="gvAdmin_Sorting" OnRowCommand="gvAdmin_RowCommand" OnPageIndexChanging="gvAdmin_PageIndexChanging" PageSize="5">
                    <Columns>
                        <asp:TemplateField>
                            <ItemTemplate>
                                <asp:LinkButton ID="lbEdit" CommandArgument='<%# Item.MstrId %>' CommandName="EditRow" ForeColor="#8C4510" runat="server">Sửa</asp:LinkButton>
                                <asp:LinkButton ID="lbDelete" CommandArgument='<%# Item.MstrId %>' CommandName="DeleteRow" ForeColor="#8C4510" runat="server" CausesValidation="false">Xóa</asp:LinkButton>
                            </ItemTemplate>
                            <EditItemTemplate>
                                <asp:LinkButton ID="lbUpdate" CommandArgument='<%# Item.MstrId %>' CommandName="UpdateRow" ForeColor="#8C4510" runat="server">Cập nhật</asp:LinkButton>
                                <asp:LinkButton ID="lbCancel" CommandArgument='<%# Item.MstrId %>' CommandName="CancelUpdate" ForeColor="#8C4510" runat="server" CausesValidation="false">Hủy</asp:LinkButton>
                            </EditItemTemplate>
                        </asp:TemplateField>
                        <asp:TemplateField HeaderText="Mã người bán" SortExpression="UsrId">
                            <ItemTemplate>
                                <%# Item.MstrId %>
                            </ItemTemplate>
                            <ItemStyle HorizontalAlign="Center" VerticalAlign="Middle" Wrap="False" />
                        </asp:TemplateField>
                        <asp:TemplateField HeaderText="Tên người bán" SortExpression="UsrName">
                            <ItemTemplate>
                                <%# Item.Usr.UsrName %>
                            </ItemTemplate>
                            <EditItemTemplate>
                                <asp:TextBox runat="server" ID="EditUsrName" Text="<%# Item.Usr.UsrName %>" />
                            </EditItemTemplate>
                        </asp:TemplateField>
                        <asp:TemplateField HeaderText="Chức vụ" SortExpression="RoleName">
                            <ItemTemplate>
                                <asp:HiddenField ID="hdfMstrId" runat="server" Value="<%# Item.MstrId %>" />
                                <asp:Label Text='<%# string.Join(",",Item.MstrDet.Where(x=>x.MstrId == Item.MstrId).Select(r=>r.MstrRole.RoleName)) %>' runat="server" ID="RoleName_Present" />
                            </ItemTemplate>
                        </asp:TemplateField>
                        <asp:TemplateField Visible="false">
                            <ItemTemplate>
                                <asp:Label Text='<%# Item.MstrDet.Where(x=>x.MstrId == Item.MstrId).Select(x=>x.RoleId) %>' runat="server" ID="RoleID_Present" />
                            </ItemTemplate>
                        </asp:TemplateField>
                        <asp:TemplateField HeaderText="Tài khoản" SortExpression="Login">
                            <ItemTemplate>
                                <%# Item.Usr.Login %>
                            </ItemTemplate>
                            <EditItemTemplate>
                                <asp:TextBox runat="server" ID="EditLogin" Text='<%# Item.Usr.Login %>' />
                                <asp:HiddenField ID="LoginOld" runat="server" Value='<%# Item.Usr.Login %>'></asp:HiddenField>
                            </EditItemTemplate>
                        </asp:TemplateField>
                        <asp:TemplateField HeaderText="Mật khẩu">
                            <ItemTemplate>
                                <%# Item.Usr.Password %>
                            </ItemTemplate>
                            <EditItemTemplate>
                                <asp:TextBox runat="server" ID="EditPassword" Text='<%# Item.Usr.Password %>' />
                                <asp:HiddenField ID="PasswordOld" runat="server" Value='<%# Item.Usr.Password %>'></asp:HiddenField>
                            </EditItemTemplate>
                        </asp:TemplateField>
                        <asp:TemplateField HeaderText="Email" SortExpression="Email">
                            <ItemTemplate>
                                <%# Item.Usr.Email %>
                            </ItemTemplate>
                            <EditItemTemplate>
                                <asp:TextBox runat="server" ID="EditEmail" Text='<%# Item.Usr.Email %>' />
                            </EditItemTemplate>
                        </asp:TemplateField>
                        <asp:TemplateField HeaderText="Địa chỉ" SortExpression="Address">
                            <ItemTemplate>
                                <%# Item.Usr.Address %>
                            </ItemTemplate>
                            <EditItemTemplate>
                                <asp:TextBox runat="server" ID="EditAddress" Text='<%# Item.Usr.Address %>' />
                            </EditItemTemplate>
                        </asp:TemplateField>
                        <asp:TemplateField HeaderText="Số điện thoại" SortExpression="Phone">
                            <ItemTemplate>
                                <%# Item.Usr.Phone %>
                            </ItemTemplate>
                            <EditItemTemplate>
                                <asp:TextBox runat="server" ID="EditPhone" Text='<%# Item.Usr.Phone %>' />
                            </EditItemTemplate>
                        </asp:TemplateField>
                        <asp:TemplateField HeaderText="Ngày thêm" SortExpression="DateAdd">
                            <ItemTemplate>
                                <%# Item.Usr.DateAdd %>
                            </ItemTemplate>
                            <EditItemTemplate>
                                <asp:TextBox runat="server" ID="EditDateAdd" Text='<%# Item.Usr.DateAdd %>' />
                            </EditItemTemplate>
                        </asp:TemplateField>
                        <asp:TemplateField HeaderText="Ngày sửa" SortExpression="DateEdit">
                            <ItemTemplate>
                                <%# Item.Usr.DateEdit %>
                            </ItemTemplate>
                        </asp:TemplateField>
                        <asp:TemplateField HeaderText="Người thêm" SortExpression="AddBy">
                            <ItemTemplate>
                                <%# Item.MstrDet.FirstOrDefault(x=>x.MstrId == Item.MstrId).AddBy %>
                            </ItemTemplate>
                        </asp:TemplateField>
                        <asp:TemplateField HeaderText="Ảnh đại diện" SortExpression="Avatar">
                            <ItemTemplate>
                                <img width="50" height="50" src="<%# MyLibrary.AdminImgPath(Item) %>" />
                            </ItemTemplate>
                            <EditItemTemplate>
                                <asp:FileUpload ID="fuploadEdit" runat="server" />
                            </EditItemTemplate>
                        </asp:TemplateField>
                        <asp:TemplateField HeaderText="Kích hoạt" SortExpression="Active">
                            <ItemTemplate>
                                <asp:CheckBox Enabled="false" runat="server" Checked='<%# Item.Usr.Active %>' />
                            </ItemTemplate>
                            <EditItemTemplate>
                                <asp:CheckBox runat="server" ID="EditActive" Checked='<%# Item.Usr.Active %>' />
                            </EditItemTemplate>
                        </asp:TemplateField>
                    </Columns>
                    <FooterStyle BackColor="#FFFFCC" ForeColor="#330099" Wrap="false" />
                    <HeaderStyle BackColor="#990000" Font-Bold="True" ForeColor="#FFFFCC" Wrap="false" />
                    <PagerSettings FirstPageText="Trang đầu" LastPageText="Trang cuối" Mode="NumericFirstLast" NextPageText="Trang kế" PreviousPageText="Trang trước" />
                    <PagerStyle BackColor="#FFFFCC" ForeColor="Red" HorizontalAlign="Left" VerticalAlign="Middle" />
                    <RowStyle BackColor="White" ForeColor="#330099" Wrap="false" />
                    <SelectedRowStyle BackColor="#FFCC66" Font-Bold="True" ForeColor="#663399" />
                    <SortedAscendingCellStyle BackColor="#FEFCEB" />
                    <SortedAscendingHeaderStyle BackColor="#AF0101" />
                    <SortedDescendingCellStyle BackColor="#F6F0C0" />
                    <SortedDescendingHeaderStyle BackColor="#7E0000" />
                </asp:GridView>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="btn btn-lg custom_bar col-12">Bảng chức vụ</div>
        <div class="row">
            <div class="col-12">
                <asp:GridView ID="gvMstrRole" ShowFooter="True" runat="server" AutoGeneratedColumns="false" BackColor="White" BorderColor="#CC9966" BorderWidth="1px" CellPadding="4" BorderStyle="None" AutoGenerateColumns="False" OnRowCommand="gvMstrRole_RowCommand">
                    <Columns>
                        <asp:TemplateField>
                            <ItemTemplate>
                                <asp:LinkButton ID="lbEdit" CommandArgument='<%# Eval("RoleId") %>' CommandName="EditRow" ForeColor="#8C4510" runat="server">Sửa</asp:LinkButton>
                            </ItemTemplate>
                            <EditItemTemplate>
                                <asp:LinkButton ID="lbUpdate" CommandArgument='<%# Eval("RoleId") %>' CommandName="UpdateRow" ForeColor="#8C4510" runat="server">Cập nhật</asp:LinkButton>
                                <asp:LinkButton ID="lbCancel" CommandArgument='<%# Eval("RoleId") %>' CommandName="CancelUpdate" ForeColor="#8C4510" runat="server" CausesValidation="false">Hủy</asp:LinkButton>
                            </EditItemTemplate>
                        </asp:TemplateField>
                        <asp:TemplateField HeaderText="Mã gói">
                            <ItemTemplate>
                                <%# Eval("RoleId") %>
                            </ItemTemplate>
                        </asp:TemplateField>
                        <asp:TemplateField HeaderText="Tên chức vụ">
                            <ItemTemplate>
                                <%# Eval("RoleName") %>
                            </ItemTemplate>
                            <EditItemTemplate>
                                <asp:TextBox runat="server" ID="EditRoleName" Text='<%# Bind("RoleName") %>' />
                            </EditItemTemplate>
                        </asp:TemplateField>
                    </Columns>
                    <FooterStyle BackColor="#FFFFCC" ForeColor="#330099" />
                    <HeaderStyle BackColor="#990000" Font-Bold="True" ForeColor="#FFFFCC" />
                    <PagerStyle BackColor="#FFFFCC" ForeColor="#330099" HorizontalAlign="Center" />
                    <RowStyle BackColor="White" ForeColor="#330099" />
                    <SelectedRowStyle BackColor="#FFCC66" Font-Bold="True" ForeColor="#663399" />
                    <SortedAscendingCellStyle BackColor="#FEFCEB" />
                    <SortedAscendingHeaderStyle BackColor="#AF0101" />
                    <SortedDescendingCellStyle BackColor="#F6F0C0" />
                    <SortedDescendingHeaderStyle BackColor="#7E0000" />
                </asp:GridView>
                <asp:ValidationSummary ID="ValidationSummary2" ValidationGroup="Role" ForeColor="Red" runat="server" />
            </div>
        </div>
    </div>
    <div class="container">
    <asp:LinkButton runat="server" ID="btnCreateUser" CssClass="btn btn-lg custom_bar_hover col-12" Text="Tạo quản trị viên mới" OnClick="btnCreateUser_Click"></asp:LinkButton>
        <asp:PlaceHolder ID="Only_Admin_Create_Administrator" runat="server" Visible="false">
            <div class="row">
                <div class="col-12">
                    <table id="ttcn" class="table table-striped table-responsive-sm table-responsive-xl table-by-truc">
                        <tr>
                            <td>Ảnh đại diện</td>
                            <td class="form-group">
                                <asp:Image runat="server" ID="upava" />
                                <asp:FileUpload runat="server" ID="fupava" />
                            </td>
                        </tr>
                        <tr>
                            <td>Họ và tên</td>
                            <td class="form-group">
                                <asp:TextBox runat="server" CssClass="form-control txt-by-truc" ID="txtUsrName"></asp:TextBox>
                            </td>
                            <td>
                                <asp:RequiredFieldValidator ID="rfvEditUsrName" runat="server" ErrorMessage="Chưa nhập họ và tên" ControlToValidate="txtUsrName" Text="*" ForeColor="Red" ValidationGroup="Insert">
                                </asp:RequiredFieldValidator>
                            </td>
                        </tr>
                        <tr>
                            <td>Số điện thoại</td>
                            <td class="form-group">
                                <asp:TextBox runat="server" TextMode="Phone" CssClass="form-control txt-by-truc" ID="txtPhone"></asp:TextBox>
                            </td>
                            <td>
                                <asp:RegularExpressionValidator ID="revPhone" runat="server"
                                    ErrorMessage="Not a valid phone" ControlToValidate="txtPhone"
                                    ValidationGroup="Insert"
                                    ValidationExpression="[0-9]{10}">
                                </asp:RegularExpressionValidator>
                                <asp:RequiredFieldValidator ID="rfvEditPhone" runat="server" ErrorMessage="Chưa nhập số điện thoại" ControlToValidate="txtPhone" Text="*" ForeColor="Red" ValidationGroup="Insert">
                                </asp:RequiredFieldValidator>
                            </td>
                        </tr>
                        <tr>
                            <td>Địa chỉ</td>
                            <td class="form-group">
                                <asp:TextBox runat="server" CssClass="form-control txt-by-truc" ID="txtAddress"></asp:TextBox>
                            </td>
                            <td>
                                <asp:RequiredFieldValidator ID="rfvEditAddress" runat="server" ErrorMessage="Chưa nhập địa chỉ" ControlToValidate="txtAddress" Text="*" ForeColor="Red" ValidationGroup="Insert">
                                </asp:RequiredFieldValidator>
                            </td>
                        </tr>
                        <tr>
                            <td>Email</td>
                            <td class="form-group">
                                <asp:TextBox runat="server" TextMode="Email" CssClass="form-control txt-by-truc" ID="txtEmail"></asp:TextBox>
                            </td>
                            <td>
                                <asp:RequiredFieldValidator ID="rfvEditEmail" runat="server" ErrorMessage="Chưa nhập email" ControlToValidate="txtEmail" Text="*" ForeColor="Red" ValidationGroup="Insert">
                                </asp:RequiredFieldValidator>
                            </td>
                        </tr>
                        <tr>
                            <td>Chức vụ</td>
                            <td class="form-group">
                                <asp:DropDownList runat="server" ID="InsertRoleName"></asp:DropDownList>
                            </td>
                        </tr>
                        <tr>
                            <td>Tên đăng nhập</td>
                            <td class="form-group">
                                <asp:TextBox runat="server" CssClass="form-control txt-by-truc" ID="txtLogin"></asp:TextBox>
                            </td>
                            <td>
                                <asp:RequiredFieldValidator ID="rfvEditLogin" runat="server" ErrorMessage="Chưa nhập tên đăng nhập" ControlToValidate="txtLogin" Text="*" ForeColor="Red" ValidationGroup="Insert">
                                </asp:RequiredFieldValidator>
                            </td>
                        </tr>
                        <tr>
                            <td>Mật khẩu</td>
                            <td class="form-group">
                                <asp:TextBox runat="server" CssClass="form-control txt-by-truc" TextMode="Password" ID="txtPassword"></asp:TextBox>
                            </td>
                            <td>
                                <asp:RequiredFieldValidator ID="rfvEditPassword" runat="server" ErrorMessage="Chưa nhập mật khẩu" ControlToValidate="txtPassword" Text="*" ForeColor="Red" ValidationGroup="Insert">
                                </asp:RequiredFieldValidator>
                            </td>
                        </tr>
                        <tr>
                            <td>Nhập lại mật khẩu</td>
                            <td class="form-group">
                                <asp:TextBox runat="server" CssClass="form-control txt-by-truc" TextMode="Password" ID="txtRepassword"></asp:TextBox>
                            </td>
                            <td>
                                <asp:RequiredFieldValidator ID="RequiredFieldValidator1" runat="server" ErrorMessage="Chưa nhập lại mật khẩu" ControlToValidate="txtRepassword" Text="*" ForeColor="Red" ValidationGroup="Insert">
                                </asp:RequiredFieldValidator>
                        </tr>
                        <tr>
                            <td class="my-info__save">
                                <asp:LinkButton runat="server" ID="lbtnTao" Text="Tạo" CssClass="txt-by-truc center" ValidationGroup="Insert" OnClick="lbtnTao_Click"></asp:LinkButton></td>
                            <td>
                                <asp:LinkButton runat="server" ID="lbtnHuy" Text="Hủy" CssClass="txt-by-truc center"></asp:LinkButton>
                            </td>
                        </tr>
                    </table>
                    <asp:ValidationSummary ID="ValidationSummary3" ValidationGroup="Insert" ForeColor="Red" runat="server" />
                </div>
            </div>
        </asp:PlaceHolder>
    </div>
</asp:Content>
